/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        \file  Pulse_Meter.c 
 *      
 *
 *      \details :  Pulse Meter Application Used To Measure Frequency and Duty Cycle of Pulses
					For Accurate Measures Range From 1 -> 4000Hz
 *
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "Pulse_meter.h"

/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL DATA 
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/
/******************************************************************************
* \Syntax          : void Pulse_Meter_Start(void)
* \Description     : Initialize The Pulse Meter Application
* \Parameters	   : void
* \Return value:   : void
*******************************************************************************/
void Pulse_Meter_Init(void){
	LCD_Init();
	IRQH_SetGlobalINT(INT_ENABLE);
	ICU_Init();
	LCD_WriteString("For -> Accuracy");
	LCD_GoTo(1,0);
	LCD_WriteString("Range 1-4000Hz");
	_delay_ms(1300);
	LCD_Clear();
}
/******************************************************************************
* \Syntax          : void Pulse_Meter_Start(void)
* \Description     : Start The Pulse Meter Application
* \Parameters	   : void
* \Return value:   : void
*******************************************************************************/
void Pulse_Meter_Start(void){
	uint32 Total_Time_Ticks=0;
	uint32 On_Time_Ticks =0;
	uint16 Duty_Cycle=0;
	uint16 Frequency =0;
	static uint8 clear_Cnt=0;
	if (ICU_Cnt == 3  && ((Cap2>Cap1)&&(Cap3>Cap2)))
	{
		if(clear_Cnt <3)clear_Cnt++;
		On_Time_Ticks = (Cap2 - Cap1);
		Total_Time_Ticks = (Cap3 - Cap1);
		Duty_Cycle = ((On_Time_Ticks*100) /Total_Time_Ticks);
		Frequency = (F_CPU / (Timer1_Prescaler_value * Total_Time_Ticks));
		LCD_GoTo(0,0);
		LCD_WriteString("Duty Cycle:");
		if(clear_Cnt <3)LCD_WriteString("      ");
		LCD_GoTo(0,11);
		LCD_WriteInteger(Duty_Cycle);
		LCD_WriteString("%");
		LCD_GoTo(1,0);
		LCD_WriteString("Freq:");
		if(clear_Cnt <3)LCD_WriteString("          ");
		LCD_GoTo(1,5);
		LCD_WriteInteger(Frequency);
		LCD_WriteString("Hz");
		_delay_ms(50);
		ICU_Cnt=255;
		SET_ICU_INTERRUPT_ENABLE();
	}
}
/**********************************************************************************************************************
 *  END OF FILE: Pulse_Meter.c 
 *********************************************************************************************************************/

